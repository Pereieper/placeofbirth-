<!-- Sidebar -->
<div class="custom-sidebar">
  <div class="logo-container">
    <img src="assets/logobgremover.png" alt="Logo" class="sidebar-logo" />
  </div>
  <ul>
    <li (click)="navigateTo('secretary-dashboard')">
      <ion-icon name="home-outline"></ion-icon>
      <span class="label">Dashboard</span>
    </li>
    <li (click)="navigateTo('user-registration')">
      <ion-icon name="person-add-outline"></ion-icon>
      <span class="label">User Registration</span>
    </li>
    <li (click)="navigateTo('user-request')">
      <ion-icon name="document-text-outline"></ion-icon>
      <span class="label">User Requests</span>
    </li>
    <li (click)="navigateTo('template')">
      <ion-icon name="document-outline"></ion-icon>
      <span class="label">Template</span>
    </li>
  </ul>

  <ul class="logout-section">
    <li (click)="logout()">
      <ion-icon name="log-out-outline"></ion-icon>
      <span class="label">Logout</span>
    </li>
  </ul>
</div>

<!-- Main Content -->
<ion-content class="ion-padding">

  <!-- Filter / Search / Notifications -->
  <ion-grid>
    <ion-row class="ion-align-items-center">
      <ion-col size="3">
        <ion-select [(ngModel)]="selectedFilter" (ionChange)="filterData(selectedFilter)">
          <ion-select-option value="thisWeek">This Week</ion-select-option>
          <ion-select-option value="lastWeek">Last Week</ion-select-option>
          <ion-select-option value="thisMonth">This Month</ion-select-option>
          <ion-select-option value="lastMonth">Last Month</ion-select-option>
          <ion-select-option value="all">All Time</ion-select-option>
        </ion-select>
      </ion-col>

      <ion-col size="4">
        <ion-searchbar placeholder="Search" animated></ion-searchbar>
      </ion-col>

      <ion-col size="3" class="ion-text-end">
        {{ currentDate | date:'MMM d, y h:mm a' }}
      </ion-col>

      <ion-col size="2" class="ion-text-end notification-wrapper">
        <ion-button fill="clear" (click)="openNotifications()">
          <ion-icon name="notifications-outline"></ion-icon>
          <ion-badge color="danger" *ngIf="notificationCount">{{ notificationCount }}</ion-badge>
        </ion-button>

        <!-- Notifications Dropdown (Facebook-style) -->
        <div *ngIf="showNotifications" class="notifications-dropdown">
          <ion-card *ngIf="notifications.length === 0">
            <ion-card-content>No new notifications</ion-card-content>
          </ion-card>

          <ion-card *ngFor="let notif of notifications" (click)="handleNotificationClick(notif)">

            <ion-item lines="none">
              <ion-avatar slot="start">
                <img [src]="notif.userPhoto || 'assets/default-avatar.png'" alt="User Photo" />
              </ion-avatar>
              <ion-label>
                <h2>{{ notif.title }}</h2>
                <p>{{ notif.message }}</p>
                <ion-note>{{ notif.timestamp | date:'shortTime' }}</ion-note>
              </ion-label>
            </ion-item>
          </ion-card>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Stats Cards -->
  <ion-grid>
    <ion-row>
      <ion-col size="4">
        <ion-card color="primary">
          <ion-card-header>
            <ion-card-title>{{ totalRequests }}</ion-card-title>
            <ion-card-subtitle>Total Requests</ion-card-subtitle>
          </ion-card-header>
        </ion-card>
      </ion-col>

      <ion-col size="4">
        <ion-card color="warning">
          <ion-card-header>
            <ion-card-title>{{ pendingRequests }}</ion-card-title>
            <ion-card-subtitle>Pending</ion-card-subtitle>
          </ion-card-header>
        </ion-card>
      </ion-col>

      <ion-col size="4">
        <ion-card color="success">
          <ion-card-header>
            <ion-card-title>{{ completedRequests }}</ion-card-title>
            <ion-card-subtitle>Completed</ion-card-subtitle>
          </ion-card-header>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Charts -->
  <ion-grid>
    <ion-row>
      <ion-col size="6">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Requests Summary</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <canvas id="barChart"></canvas>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="6">
        <ion-card>
          <ion-card-header>
            <ion-card-title>User Status Distribution</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <canvas id="statusChart" class="small-chart"></canvas>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Request Table -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Request List (Latest 5)</ion-card-title>
      <ion-card-subtitle *ngIf="filteredData.length > 0">
        Showing the 5 most recent requests
      </ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <ion-grid>
        <ion-row class="ion-text-center header-row">
          <ion-col>Photo</ion-col>
          <ion-col>Name</ion-col>
          <ion-col>Document</ion-col>
          <ion-col>Purpose</ion-col>
          <ion-col>Copies</ion-col>
          <ion-col>Contact</ion-col>
          <ion-col>Status</ion-col>
          <ion-col>Actions</ion-col>
        </ion-row>

        <ion-row *ngFor="let req of filteredData" class="ion-text-center data-row" style="cursor:pointer">
  <ion-col>
    <img [src]="convertPhoto(req.user?.photo)" alt="User Photo" class="user-photo" />
  </ion-col>

  <ion-col>
    {{ req.user?.firstName || 'Unknown' }} {{ req.user?.middleName || '' }} {{ req.user?.lastName || '' }}
  </ion-col>

  <ion-col>{{ req.documentType || '-' }}</ion-col>
  <ion-col>{{ req.purpose || '-' }}</ion-col>
  <ion-col>{{ req.copies || '-' }}</ion-col>
  <ion-col>{{ req.contact || '-' }}</ion-col>

  <ion-col>
    <ion-badge [color]="getStatusColor(req.status || 'Pending')">
      {{ req.status || 'Pending' }}
    </ion-badge>
  </ion-col>

  <ion-col>
    <ion-button fill="clear" size="small" color="primary" (click)="goToUserRequest(req)">
      <ion-icon name="eye-outline"></ion-icon>
    </ion-button>
  </ion-col>
</ion-row>

      </ion-grid>
    </ion-card-content>
  </ion-card>

</ion-content>
